<div class="panel-content content">


<{* form elements must be named with their object name hyphen field name *}>
<{* no other elements should have hyphens, since that tells the saving system that this is a property of an object to update *}>
<{* securitytoken should be part of the form *}>
<{* formulize_admin_handler and formulize_admin_key are required, to tell what the name of the save handling file is, and what the key is that we're inserting/updating on *}>

<form id="form-<{$number}>" class="formulize-admin-form">
<{php}>print $GLOBALS['xoopsSecurity']->getTokenHTML()<{/php}>
<input type="hidden" name="formulize_admin_handler" value="form_settings">
<input type="hidden" name="formulize_admin_key" value="<{$content.fid}>">
<input type="hidden" name="application_url_id" value="<{$content.aid}>">
<input type="hidden" id="reload_settings" name="reload_settings" value="<{if $content.fid == 'new'}>1<{/if}>">
<input type="hidden" class="entries-are-users-conditions-conditionsdelete" name="conditionsdelete" value="">


		<div class="form-item required">
        	<fieldset>
                <legend>Form Name and Labels</legend>
								<p><label for="forms-form_title" class="question"><{$smarty.const._AM_SETTINGS_FORM_TITLE}></label>
								<input type="text" id="forms-form_title" name="forms-form_title" class="required_formulize_element" value="<{$content.name}>" <{if $content.name == ""}>placeholder="<{$smarty.const._AM_APP_NEWFORM}>"<{/if}> onkeyup="fillHandle()" /> <a class="tooltip"><span><{$smarty.const._AM_SETTINGS_FORM_TITLE_EXPLAIN}></span></a></p>
								<div id="form-names-flex">
									<div class='spacer-line'></div>
									<p><label for="forms-singular" class="question"><{$smarty.const._AM_SETTINGS_FORM_SINGULAR}></label>
									<input type="text" id="forms-singular" name="forms-singular" value="<{$content.singular}>" <{if $content.name == ""}>placeholder="<{$smarty.const._AM_APP_NEWSINGULAR}>"<{/if}>/> <a class="tooltip"><span><{$smarty.const._AM_SETTINGS_FORM_SINGULAR_EXPLAIN}></span></a></p>
									<div class='spacer'></div>
									<p><label for="forms-plural" class="question"><{$smarty.const._AM_SETTINGS_FORM_PLURAL}></label>
									<input type="text" id="forms-plural" name="forms-plural" value="<{$content.plural}>" <{if $content.name == ""}>placeholder="<{$smarty.const._AM_APP_NEWPLURAL}>"<{/if}>/> <a class="tooltip"><span><{$smarty.const._AM_SETTINGS_FORM_PLURAL_EXPLAIN}></span></a></p>
									<div class='spacer'></div>
									<P><label for="forms-form_handle" class="question"><{$smarty.const._AM_SETTINGS_FORM_HANDLE}></label>
									<input type="text" name="forms-form_handle" value="<{$content.form_handle}>" > <a class="tooltip"><span><{$smarty.const._AM_SETTINGS_FORM_HANDLE_EXPLAIN}></span></a></P>
								</div>
            </fieldset>
		</div>

		<{if $content.istableform == false AND $content.fid != 'new'}>
			<{include file="db:admin/primary_identifier_selection.html" content=$content}>
		<{elseif $content.fid == 'new'}>
			<div class="form-item">
				<fieldset>
					<legend><label class="question"><{$smarty.const._AM_SETTINGS_FORM_PI_NEW}></label></legend>
					<label for="pi-new-no"><input type="radio" id="pi-new-no" name="pi_new_yes_no" value="no" checked /><{$smarty.const._AM_NO}></label>
					<br>
					<label for="pi-new-yes"><input type="radio" id="pi-new-yes" name="pi_new_yes_no" value="yes" /><{$smarty.const._AM_SETTINGS_FORM_PI_NEW_YES}><input type="text" name="pi_new_caption" value="<{$smarty.const._AM_ITEMNAME}>" /></label>
					<div class="description">
						<{$smarty.const._AM_SETTINGS_FORM_PI_DESC}>
					</div>
				</fieldset>
			</div>
		<{/if}>

		<{if $content.fid != 'new'}>
			<div class="form-item">
       	<fieldset>
					<legend><label class="question">Connections with other forms</label></legend>
					<{if $content.connections}>
					<{include file="db:admin/relationship_listing.html" sectionContent=$content.connections}>
					<{/if}>
					<p><a class='relationship-link-create-connection' target='<{$content.fid}>' href=""><img src="../images/filenew2.png"> Create a Connection</a></p>
				</fieldset>
			</div>
		<{/if}>

		<div class="form-item">
			<fieldset>
					<legend><label class="question"><{$smarty.const._AM_SETTINGS_FORM_APP_PART}></label></legend>
					<{if $content.applications|is_array AND $content.applications|@count > 0}>
					<select name="apps[]" id="apps" size=10 multiple>
							<{foreach from=$content.applications item=application}>
									<option value=<{$application.appid}><{$application.selected}>><{$application.text}></option>
							<{/foreach}>
					</select>
					<{/if}>
					<p><{$smarty.const._AM_SETTINGS_FORM_APPNEW}></p>
					<div class="form-radios radio-inline">
							<label for="new-app-yes"><input type="radio" id="new-app-yes" name="new_app_yes_no" value="yes" <{if $content.fid == 'new' AND $content.applications|@count == 0}>checked<{/if}> /><{$smarty.const._AM_YES}></label>
					</div>
					<div class="form-radios radio-inline">
							<label for="new-app-no"><input type="radio" id="new-app-no" name="new_app_yes_no" value="no" <{if $content.fid != 'new' OR $content.applications|@count > 0}>checked<{/if}> /><{$smarty.const._AM_NO}></label>
					</div>
					<div class="form-item" id="new-application-box" <{if $content.fid != 'new' OR $content.applications|@count > 0}>style="display: none;"<{/if}>>
					<label class="question">What is the name of the new application?</label>
					<input type="text" id="applications-name" name="applications-name" value="<{if $content.fid == 'new' AND $content.applications|@count == 0}>Forms and Data<{/if}>" />
			</fieldset>
		</div>

		<{if $content.istableform == true && $content.fid == "new"}>
			<div class="form-item">
				<fieldset>
                    <legend><label for="database_table" class="question"><{$smarty.const._AM_SETTINGS_FORM_DATABASE}></label></legend>
                    <input type="text" id="forms-tableform" name="forms-tableform" value="" />
                    <div class="description">
                        <p><{$smarty.const._AM_SETTINGS_FORM_DATABASE_EXPLAIN}></p>
                    </div>
                </fieldset>
			</div>
		<{/if}>

		<{if $content.istableform == false}>

			<div class="form-item">
        	<fieldset>
				<legend><label class="question"><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ALLOWED}></label></legend>

				<div class="form-radios">
					<label for="group"><input type="radio" id="group" name="forms-single" value="group" /><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ONEPERGROUP}></label>
				</div>
				<div class="form-radios">
					<label for="on"><input type="radio" id="user" name="forms-single" value="user" /><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ONEPERUSER}></label>
				</div>
				<div class="form-radios">
					<label for="empty"><input type="radio" id="off" name="forms-single" value="off" /><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_MORETHANONE}></label>
				</div>
             </fieldset>
		</div>

		<!-- Entries Represent Users -->
		<!-- TODO add option for entry_user_is_owner!! -->
		<div class="form-item" id="entries_are_users_container">
			<fieldset>
				<legend><label class="question"><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_USERS}></label></legend>
				<div class="form-radios">
					<label for="entries_are_users-0">
						<input type="radio" id="entries_are_users-0" name="forms-entries_are_users" value="0" />
						<{$smarty.const._AM_NO}>
					</label>
				</div>
				<div class="form-radios">
					<label for="entries_are_users-1">
						<input type="radio" id="entries_are_users-1" name="forms-entries_are_users" value="1" />
						<{$smarty.const._AM_YES}>
					</label>
				</div>
				<div class="description">
					<p><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_USERS_EXPLAIN}></p>
				</div>

				<!-- Group Membership -->
				<{if $content.entries_are_users_default_groups_ui}>
				<div id="entries_are_users_default_groups_container" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ddd; background: #f9f9f9;">
					<h4 style="margin-top: 0;"><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_USERS_DEFAULT_GROUPS_TITLE}></h4>
					<p><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_USERS_DEFAULT_GROUPS_DESC}></p>
					<{$content.entries_are_users_default_groups_ui}>
					<div id="default_groups_selected_list" style="margin-top: 10px;">
						<{if $content.entries_are_users_default_groups_selected|is_array}>
						<{foreach from=$content.entries_are_users_default_groups_selected item=group}>
						<div class="default-group-item" data-groupid="<{$group.id}>" style="margin-bottom: 5px; padding: 4px 8px; background: #e9e9e9; border-radius: 3px;">
							<div style="display: flex; align-items: center; gap: 10px;">
								<span style="flex: 1; font-weight: bold;"><{$group.name}></span>
								<input type="hidden" name="entries_are_users_default_groups[]" value="<{$group.id}>" />
								<button type="button" class="remove-default-group-btn" style="padding: 2px 6px; cursor: pointer; border: none; background: none; font-size: 14px;" title="Remove">&times;</button>
							</div>
							<{if $group.description}>
							<div style="font-size: 0.85em; font-style: italic; color: #666; margin-top: 2px;"><{$group.description}></div>
							<{/if}>
						</div>
						<{/foreach}>
						<{/if}>
					</div>
				</div>
				<{/if}>

				<!-- User Creation Conditions -->
				<{if $content.entries_are_users_conditions_ui}>
				<div id="entries_are_users_conditions_container" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ddd; background: #f9f9f9;">
					<h4 style="margin-top: 0;"><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_USERS_CONDITIONS_TITLE}></h4>
					<{$content.entries_are_users_conditions_ui}>
					<div class="description">
						<p><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_USERS_CONDITIONS_DESC}></p>
					</div>
				</div>
				<{/if}>

				<!-- User Mapping for Existing Entries -->
				<{if $content.show_user_mapping_ui AND $content.elementheadings|is_array AND $content.elementheadings|@count}>
				<div id="user_mapping_container" style="margin-top: 15px; padding: 15px; border: 1px solid #ddd; background: #f9f9f9;">
					<h4 style="margin-top: 0;"><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_TITLE}></h4>
					<p><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_QUESTION}></p>

					<div class="form-radios">
						<label for="user_mapping_yes_no-0">
							<input type="radio" id="user_mapping_yes_no-0" name="user_mapping_yes_no" value="0" checked />
							<{$smarty.const._AM_NO}>
						</label>
					</div>
					<div class="form-radios">
						<label for="user_mapping_yes_no-1">
							<input type="radio" id="user_mapping_yes_no-1" name="user_mapping_yes_no" value="1" />
							<{$smarty.const._AM_YES}>
						</label>
					</div>

					<div id="user_mapping_details" style="display: none; margin-top: 15px;">
						<p><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_EXPLAIN}></p>

						<div style="display: flex; gap: 30px; margin-top: 10px;">
							<div style="display: flex; flex-direction: column;">
								<label style="font-weight: bold; margin-bottom: 5px;"><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_ELEMENT_LABEL}></label>
								<select name="user_mapping_element" id="user_mapping_element" style="width: auto;">
									<option value=""><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_ELEMENT_SELECT}></option>
									<{foreach from=$content.elementheadings item=element}>
									<option value="<{$element.ele_id}>"><{$element.text}></option>
									<{/foreach}>
								</select>
							</div>
							<div style="display: flex; flex-direction: column;">
								<label style="font-weight: bold; margin-bottom: 5px;"><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_CONTAINS_LABEL}></label>
								<label for="user_mapping_type-login_name" style="margin-bottom: 3px;">
									<input type="radio" id="user_mapping_type-login_name" name="user_mapping_type" value="login_name" />
									<{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_TYPE_USERNAME}>
								</label>
								<label for="user_mapping_type-email" style="margin-bottom: 3px;">
									<input type="radio" id="user_mapping_type-email" name="user_mapping_type" value="email" />
									<{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_TYPE_EMAIL}>
								</label>
								<label for="user_mapping_type-uid">
									<input type="radio" id="user_mapping_type-uid" name="user_mapping_type" value="uid" />
									<{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_TYPE_UID}>
								</label>
							</div>
						</div>

						<p style="margin-top: 10px;"><em><{$smarty.const._AM_SETTINGS_FORM_USER_MAPPING_SYNC_NOTE}></em></p>
					</div>
				</div>
				<{/if}>
			</fieldset>
		</div>

		<!-- Entries Represent Groups -->
		<div class="form-item" id="entries_are_groups_container">
			<fieldset>
				<legend><label class="question"><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_GROUPS}></label></legend>
				<div class="form-radios">
					<label for="entries_are_groups-0">
						<input type="radio" id="entries_are_groups-0" name="forms-entries_are_groups" value="0" />
						<{$smarty.const._AM_NO}>
					</label>
				</div>
				<div class="form-radios">
					<label for="entries_are_groups-1">
						<input type="radio" id="entries_are_groups-1" name="forms-entries_are_groups" value="1" />
						<{$smarty.const._AM_YES}>
					</label>
				</div>
				<div class="description">
					<p><{$smarty.const._AM_SETTINGS_FORM_ENTRIES_ARE_GROUPS_EXPLAIN}></p>
				</div>

				<!-- Group Categories Configuration -->
				<div id="group_categories_container" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ddd; background: #f9f9f9;">
					<h4 style="margin-top: 0;"><{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_TITLE}></h4>

					<!-- Base category - always present, not editable -->
					<div style="margin-top: 15px;">
						<div class="group-category-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
							<input type="text" value="<{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_ALL_USERS}>" style="flex: 1; max-width: 300px; background: #e9e9e9; color: #666;" disabled />
						</div>
					</div>

					<div id="group_categories_list">
						<!-- Additional categories will be listed here -->
						<!-- For existing categories, the key ($groupid) is the group ID in the database -->
						<!-- For new categories added via JS, the key will be "new_X" where X is a counter -->
						<{if $content.group_categories|is_array}>
						<{foreach from=$content.group_categories item=category key=groupid}>
						<div class="group-category-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
							<input type="text" name="group_categories[<{$groupid}>]" value="<{$category}>" style="flex: 1; max-width: 300px;" placeholder="<{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_PLACEHOLDER}>" />
							<button type="button" class="remove-category-btn" style="padding: 4px 8px; cursor: pointer;" title="<{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_REMOVE}>">&times;</button>
						</div>
						<{/foreach}>
						<{/if}>
					</div>

					<div style="margin-top: 15px;">
						<button type="button" id="add_group_category_btn" style="padding: 6px 12px; cursor: pointer;">
							<img src="../images/filenew2.png" style="vertical-align: middle; margin-right: 5px;" alt="" /><{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_ADD}>
						</button>
					</div>

					<p style="margin-top: 15px;"><em><{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_NOTE}></em></p>
				</div>
			</fieldset>
		</div>

		<script>
		// Initialize checked state
		$("#entries_are_users-<{$content.entries_are_users}>").attr('checked', 'checked');
		$("#entries_are_groups-<{$content.entries_are_groups}>").attr('checked', 'checked');

		// Initialize visibility based on current values
		if (parseInt("<{$content.entries_are_users}>") == 1) {
			$("#entries_are_groups_container").hide();
		}
		if (parseInt("<{$content.entries_are_groups}>") == 1) {
			$("#entries_are_users_container").hide();
			$("#group_categories_container").show();
		}

		// Initialize user mapping container visibility based on entries_are_users
		if (parseInt("<{$content.entries_are_users}>") != 1) {
			$("#user_mapping_container").hide();
			$("#entries_are_users_conditions_container").hide();
			$("#entries_are_users_default_groups_container").hide();
		} else {
			$("#entries_are_users_conditions_container").show();
			$("#entries_are_users_default_groups_container").show();
		}

		// Mutual exclusivity: if one is set to Yes, set the other to No and hide it
		$("input[name='forms-entries_are_users']").change(function() {
			if ($(this).val() == "1" && $(this).is(':checked')) {
				$("#entries_are_groups-0").attr('checked', 'checked');
				$("#entries_are_groups_container").slideUp();
				$("#group_categories_container").slideUp();
				$("#user_mapping_container").slideDown();
				$("#entries_are_users_conditions_container").slideDown();
				$("#entries_are_users_default_groups_container").slideDown();
			} else if ($(this).val() == "0" && $(this).is(':checked')) {
				$("#entries_are_groups_container").slideDown();
				$("#user_mapping_container").slideUp();
				$("#entries_are_users_conditions_container").slideUp();
				$("#entries_are_users_default_groups_container").slideUp();
			}
		});

		$("input[name='forms-entries_are_groups']").change(function() {
			if ($(this).val() == "1" && $(this).is(':checked')) {
				$("#entries_are_users-0").attr('checked', 'checked');
				$("#entries_are_users_container").slideUp();
				$("#user_mapping_container").slideUp();
				$("#entries_are_users_conditions_container").slideUp();
				$("#entries_are_users_default_groups_container").slideUp();
				$("#group_categories_container").slideDown();
			} else if ($(this).val() == "0" && $(this).is(':checked')) {
				$("#entries_are_users_container").slideDown();
				$("#group_categories_container").slideUp();
			}
		});

		// User mapping yes/no toggle
		$("input[name='user_mapping_yes_no']").change(function() {
			if ($(this).val() == "1" && $(this).is(':checked')) {
				$("#user_mapping_details").slideDown();
			} else if ($(this).val() == "0" && $(this).is(':checked')) {
				$("#user_mapping_details").slideUp();
			}
		});

		// Group categories management
		// Counter for new categories (keys will be "new_0", "new_1", etc.)
		var newCategoryCounter = 0;
		$("#add_group_category_btn").click(function() {
			var newKey = 'new_' + newCategoryCounter;
			newCategoryCounter++;
			var newCategoryHtml = '<div class="group-category-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
				'<input type="text" name="group_categories[' + newKey + ']" value="" style="flex: 1; max-width: 300px;" placeholder="<{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_PLACEHOLDER}>" />' +
				'<button type="button" class="remove-category-btn" style="padding: 4px 8px; cursor: pointer;" title="<{$smarty.const._AM_SETTINGS_FORM_GROUP_CATEGORIES_REMOVE}>">&times;</button>' +
				'</div>';
			$("#group_categories_list").append(newCategoryHtml);
			// Focus on the new input
			$("#group_categories_list .group-category-item:last-child input").focus();
		});

		// Remove category button handler (using delegation for dynamically added elements)
		$(".remove-category-btn").live("click", function() {
			$(this).closest(".group-category-item").remove();
		});

		// Template group metadata for explanatory descriptions
		var templateGroupMetadata = <{$content.template_group_metadata_json}>;

		// Override the default groups autocomplete select behaviour
		// Instead of setting the textbox value, add the selected group to a list below
		$(window).load(function() {
			// Remove the original single-value hidden input so it doesn't conflict with the array inputs
			$("#entries_are_users_default_groups").remove();
			var $ac = $("#entries_are_users_default_groups_user");
			if ($ac.length && $ac.data("autocomplete")) {
				$ac.autocomplete("option", "select", function(event, ui) {
					event.preventDefault();
					if (ui.item.value == "none") {
						$ac.val("");
						return;
					}
					var groupId = ui.item.value;
					var groupName = ui.item.label;
					// Check if this group is already in the list
					if ($("#default_groups_selected_list .default-group-item[data-groupid='" + groupId + "']").length > 0) {
						$ac.val("");
						return;
					}
					// Build description HTML if this is a template group
					var descriptionHtml = '';
					if (templateGroupMetadata[groupId] && templateGroupMetadata[groupId].description) {
						descriptionHtml = '<div style="font-size: 0.85em; font-style: italic; color: #666; margin-top: 2px;">' + templateGroupMetadata[groupId].description + '</div>';
					}
					// Add to the list
					var itemHtml = '<div class="default-group-item" data-groupid="' + groupId + '" style="margin-bottom: 5px; padding: 4px 8px; background: #e9e9e9; border-radius: 3px;">' +
						'<div style="display: flex; align-items: center; gap: 10px;">' +
						'<span style="flex: 1; font-weight: bold;">' + groupName + '</span>' +
						'<input type="hidden" name="entries_are_users_default_groups[]" value="' + groupId + '" />' +
						'<button type="button" class="remove-default-group-btn" style="padding: 2px 6px; cursor: pointer; border: none; background: none; font-size: 14px;" title="Remove">&times;</button>' +
						'</div>' +
						descriptionHtml +
						'</div>';
					$("#default_groups_selected_list").append(itemHtml);
					$ac.val("");
				});
				// Also override the blur to just clear the box without setting the hidden value
				$ac.unbind("blur").blur(function() {
					$ac.val("");
				});
			}
		});

		// Remove default group from list
		$(".remove-default-group-btn").live("click", function() {
			$(this).closest(".default-group-item").remove();
		});
		</script>

			<div class="form-item">
				<fieldset>
					<legend><label class="question">Do you want to keep a revision history of all the changes people make to entries in this form?</label></legend>
					<div class="form-radios">
						<label for="store_revisions-0"><input type="radio" <{$content.revisionsDisabled}> id="store_revisions-0" name="forms-store_revisions" value="0" />No</label>
					</div>
					<div class="form-radios">
						<label for="store_revisions-1"><input type="radio" <{$content.revisionsDisabled}> id="store_revisions-1" name="forms-store_revisions" value="1" />Yes, store revision history for this form</label>
					</div>
					<div class="description">
						<p>This can increase the size of your database <b>a lot</b> if you turn on revisions for a form where entries are updated very often!</p><p>You can turn this on for all forms at once, through the <a href="../../system/admin.php?fct=preferences&op=showmod&mod=<{$adminPage.formulizeModId}>">Formulize preferences</a>. If you do that, then you cannot alter it here. This option becomes disabled.</p>
					</div>
				</fieldset>
			</div>

  		<div class="form-item">
				<fieldset>
					<legend><label class="question">Do you want to send notification e-mails for activity in this form once a day as a digest?</label></legend>
					<div class="form-radios">
						<label for="send_digests-0"><input type="radio" id="send_digests-0" name="forms-send_digests" value="0" />No, send notifications right away</label>
					</div>
					<div class="form-radios">
						<label for="send_digests-1"><input type="radio" id="send_digests-1" name="forms-send_digests" value="1" />Yes</label>
					</div>
					<div class="description">
						<p>This feature requires that you turn on the <a href="<{$xoops_url}>/modules/system/admin.php?fct=preferences&op=showmod&mod=<{$adminPage.formulizeModId}>">Formulize module Preference</a> for sending nofitications via cron job. In addition to creating a cron job for triggering 'notify.php' to process notification events, you will need to set a cron job for triggering 'digest.php' which will actually send the digest e-mails.</p>
					</div>
				</fieldset>
			</div>


	<{/if}>

	<{if $content.fid == "new"}>
	<div class="form-item">
	<fieldset>
		<legend><label class="question"><{$smarty.const._AM_SETTINGS_FORM_DEFAULT_GROUP_PERM}></label></legend>
		<select name="groups_can_edit[]" multiple size=8>
		<{html_options options=$content.groupsCanEditOptions selected=$content.groupsCanEditDefaults}>
		</select>
	</fieldset>
	</div>
<{else if $content.istableform == false}>
	<div class="form-item">
		<fieldset>
					<legend><label for="forms-form_title" class="question"><{$smarty.const._AM_EOG_Repair}>
					</label>
					</legend><input type="button" id="fix_entries" value="Repair Ownership table">
			 </fieldset>
	</div>
	<{if $content.fid != "new" AND $content.elementheadings|is_array AND $content.elementheadings|@count}>
	<div class="form-item">
		<fieldset>
							<legend><{$smarty.const._AM_SETTINGS_FORM_SHOWING_LIST_TITLE}></legend>
							<p><{$smarty.const._AM_SETTINGS_FORM_SHOWING_LIST}></p><br>
							<select name=headerlist[] size=10 multiple class="form-multiple-select">
									<{foreach from=$content.elementheadings item=element}>
									<option value=<{$element.ele_id}><{$element.selected}>><{$element.text}></option>
									<{/foreach}>
							</select>
					</fieldset>
	</div>
	<{/if}>
<{/if}>

<div class="form-item">
	<fieldset>
		<legend><label class="question">Notes</label></legend>
		<textarea id="forms-note" name="forms-note"><{$content.note}></textarea>
	</fieldset>
</div>

</form>
<!-- Thanks to https://github.com/plurals/pluralize/ !! -->
<script type="text/javascript" src="<{$xoops_url}>/modules/formulize/libraries/pluralize.js"></script>
<script type="text/javascript">
  $("#<{$content.singleentry}>").attr('checked', true);
  $("#store_revisions-<{$content.store_revisions}>").attr('checked', true);
  $("#send_digests-<{$content.send_digests}>").attr('checked', true);

	$("#forms-form_title").keydown(function () {
		window.document.getElementById('reload_settings').value = 1;
	});

	$('input:radio[name=new_app_yes_no]').change(function(){
		if($('input:radio[name=new_app_yes_no]:checked').val() == 'yes') {
			window.document.getElementById("new-application-box").style.display = 'block';
		} else {
			window.document.getElementById("new-application-box").style.display = 'none';
		}
		});

	$(".savebutton").click(function() {
		if($("[name=forms-form_title]").val() == "") {
			alert("Forms must have a name!");
			$("[name=forms-form_title]").focus();
		}
		if ($("[name=forms-form_handle]").val() == "") {
			fillHandle();
		}

	});
	function fillHandle(){
		var str=$("[name=forms-form_title]").val();
		if ("<{$content.fid}>" == "new") {
			handle=str.toLowerCase().replace(new RegExp("[^a-z0-9]","gm"),"_");
			handle=handle.replace(new RegExp("_{2,}","gm"),"_").substring(0,20);
			$("[name=forms-form_handle]").val(handle);
		}
		const suffixes = ["form", "data"];
		var formSuffix = suffixes.includes(str.substr(-4, 4).toLowerCase()) ? str.substr(-5, 5) : ''; // if/when suffixes aren't all four chars, this needs to change!
		if(formSuffix) {
			str = str.substr(0, str.length - 5);
		}
		if(pluralize.isSingular(str)) {
			var singular=str
			var plural=pluralize.plural(str)
		} else {
			var singular=pluralize.singular(str)
			var plural=str
		}
		$("[name=forms-singular]").val(singular);
		$("[name=forms-plural]").val(plural);
	}
	$('#fix_entries').click(function(){
		$.ajax({
			type:"POST",
			url:"<{$xoops_url}>/modules/formulize/admin/repair_eog_table.php",
			data:{"form_id":"<{$content.fid}>","form_handle":"<{$content.form_handle}>"},
			success:function(response){
				alert(response);
			}
		});
	});

	$("select[name=forms-pi]").change(function() {
		setPI($(this).val()); // function on elements tab
	});

	$('input[name=pi_new_caption]').keyup(function() {
		$('input[name=pi_new_yes_no][value=yes]').attr('checked', true);
	});
	$('input[name=pi_new_caption]').change(function() {
		$('input[name=pi_new_yes_no][value=yes]').attr('checked', true);
	});

	// Handle add condition button for entries_are_users_conditions (only for existing forms)
	$("div#entries_are_users_conditions_container input[name=addcon]").click(function () {
		$("#reload_settings").val(1);
		$(".savebutton").click();
		return false;
	});

	// Handle delete condition link for entries_are_users_conditions
	$("div#entries_are_users_conditions_container a.conditionsdelete").click(function () {
		$(".entries-are-users-conditions-conditionsdelete").val($(this).attr('target'));
		$("#reload_settings").val(1);
		$(".savebutton").click();
		return false;
	});

</script>
<div style="clear: both"></div>
</div> <!--// end content -->
